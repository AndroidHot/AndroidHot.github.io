<!DOCTYPE html>



  


<html class="theme-next mist use-motion" lang="zh-Hans">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>
<meta name="theme-color" content="#222">









<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />




  
  
  
  

  
    
    
  

  

  

  

  

  
    
    
    <link href="//fonts.googleapis.com/css?family=Lato:300,300italic,400,400italic,700,700italic&subset=latin,latin-ext" rel="stylesheet" type="text/css">
  






<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.2" rel="stylesheet" type="text/css" />


  <meta name="keywords" content="Hexo, NexT" />








  <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico?v=5.1.2" />






<meta name="description" content="Stay hungry, Stay foolish.">
<meta property="og:type" content="website">
<meta property="og:title" content="假装在香港">
<meta property="og:url" content="https://androidhot.github.io/index.html">
<meta property="og:site_name" content="假装在香港">
<meta property="og:description" content="Stay hungry, Stay foolish.">
<meta property="og:locale" content="zh-Hans">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="假装在香港">
<meta name="twitter:description" content="Stay hungry, Stay foolish.">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Mist',
    sidebar: {"position":"left","display":"post","offset":12,"offset_float":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: true,
    tabs: true,
    motion: true,
    duoshuo: {
      userId: '0',
      author: '博主'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="https://androidhot.github.io/"/>





  <title>假装在香港</title>
  














</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  
  
    
  

  <div class="container sidebar-position-left 
   page-home 
 ">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/"  class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">假装在香港</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle"></p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-th"></i> <br />
            
            分类
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            归档
          </a>
        </li>
      
        
        <li class="menu-item menu-item-book">
          <a href="/book/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-book"></i> <br />
            
            书单
          </a>
        </li>
      
        
        <li class="menu-item menu-item-about">
          <a href="/about/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-user"></i> <br />
            
            关于
          </a>
        </li>
      

      
    </ul>
  

  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://androidhot.github.io/2019/03/19/2019-03-19_Transitions_Everywhere/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Zhiwei Li">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="https://avatars3.githubusercontent.com/u/17120655?v=4&u=d17931ce5e11210e09e2caf8140a7cba9fe60a71&s=400">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="假装在香港">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2019/03/19/2019-03-19_Transitions_Everywhere/" itemprop="url">Transitions Everywhere</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2019-03-19T21:24:22+08:00">
                2019-03-19
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Android/" itemprop="url" rel="index">
                    <span itemprop="name">Android</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>本文是 <a href="https://developer.android.com/training/transitions/overview.html" target="_blank" rel="external">Android Transition Framework</a> 的学习笔记，先来看一下官网的简介：</p>
<blockquote>
<p>Android’s transition framework allows you to animate all kinds of motion in your UI by simply providing the starting layout and the ending layout. You can select what type of animation you want (such to fade the views in/out or change the view sizes) and the transition framework figures out how to animate from the starting layout to the ending layout.</p>
</blockquote>
<p>Android Transition Framework 主要用来做下面这三件事情：</p>
<ol>
<li>从一个 Activity 跳转到另一个 Activity 的时候添加一个过渡动画。</li>
<li>不同 Activity 间的分享元素过渡动画。</li>
<li>给 Activity 内的 View 添加动画。</li>
</ol>
<p>下面会从这三个方面来介绍 Transition。</p>
<h2 id="1-简单的-Activity-过渡动画"><a href="#1-简单的-Activity-过渡动画" class="headerlink" title="1. 简单的 Activity 过渡动画"></a>1. 简单的 Activity 过渡动画</h2><p>第一种使用场景是：在 Activity 跳转时，给 Activity 内的 View 添加动画。</p>
<p><img src="http://ww1.sinaimg.cn/large/9db97af6gy1g186gdpj0gj20mc0d3aa3.jpg" alt="transition A to B"></p>
<p>Activity 间的过渡动画有三种，分别是：Explode，Slide，Fade。先来看下效果：</p>
<p>Explode:</p>
<p><img src="http://ww1.sinaimg.cn/large/9db97af6gy1g18735vnf7g20a80i6nio.gif" alt="Explode"></p>
<p>Slide:</p>
<p><img src="http://ww1.sinaimg.cn/large/9db97af6gy1g18746lwt1g20a80i6h7f.gif" alt="Slide"></p>
<p>Fade:</p>
<p><img src="http://ww1.sinaimg.cn/large/9db97af6gy1g1874mylq2g20a80i64kl.gif" alt="Fade"></p>
<p><strong>使用方式：</strong></p>
<p>1.创建你想要使用的 Transition 效果并进行一些设置。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">Slide slideTransition=<span class="keyword">new</span> Slide();</div><div class="line">slideTransition.setSlideEdge(Gravity.LEFT);</div><div class="line">slideTransition.setDuration(getResources().getInteger(R.integer.anim_duration_long));</div></pre></td></tr></table></figure>
<p>2.设置使用动画的时机。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">getWindow().setEnterTransition(slideTransition); <span class="comment">// 设置进入动画</span></div><div class="line">getWindow().setExitTransition(slideTransition); <span class="comment">// 设置退出动画</span></div><div class="line">getWindow().setReturnTransition(slideTransition); <span class="comment">// 设置返回的动画</span></div><div class="line">getWindow().setReenterTransition(slideTransition); <span class="comment">// 设置重新进入的动画</span></div></pre></td></tr></table></figure>
<ul>
<li>当没有设置 <code>ReturnTransition</code> 时，此时退出当前的 Activity B 返回之前的 Activity A，当前的 Activity B 会使用 <code>EnterTransition</code> 来作为退出的过渡动画。</li>
<li>当没有设置 <code>ReenterTransition</code> 时，此时重新进入之前的 Activity A 时，Activity A 会使用 <code>ExitTransition</code> 来作为进入的过渡动画。</li>
</ul>
<p>除了直接在 Java / Kotlin 代码中创建 Transition 外，还可以使用定义在 XML 中的 Transition：</p>
<blockquote>
<p>res/transition/activity_fade.xml</p>
</blockquote>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">&lt;?xml version="1.0" encoding="utf-8"?&gt;</div><div class="line"><span class="tag">&lt;<span class="name">slide</span> <span class="attr">xmlns:android</span>=<span class="string">"http://schemas.android.com/apk/res/"</span></span></div><div class="line"><span class="tag">    <span class="attr">android:duration</span>=<span class="string">"1000"</span>/&gt;</span></div></pre></td></tr></table></figure>
<p>然后，在代码中使用 <code>TransitionInflater</code> 来加载 XML 中定义的 Transition：</p>
<blockquote>
<p>MainActivity.java</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line"><span class="meta">@Override</span></div><div class="line"><span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onCreate</span><span class="params">(Bundle savedInstanceState)</span> </span>&#123;</div><div class="line">    <span class="keyword">super</span>.onCreate(savedInstanceState);</div><div class="line">    setContentView(R.layout.activity_transition);</div><div class="line">    setupWindowAnimations();</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">setupWindowAnimations</span><span class="params">()</span> </span>&#123;</div><div class="line">    Slide slide = TransitionInflater.from(<span class="keyword">this</span>).inflateTransition(R.transition.activity_slide);</div><div class="line">    getWindow().setExitTransition(slide);</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h2 id="2-分享元素的过渡动画"><a href="#2-分享元素的过渡动画" class="headerlink" title="2. 分享元素的过渡动画"></a>2. 分享元素的过渡动画</h2><p><img src="http://ww1.sinaimg.cn/large/9db97af6gy1g1886gxvzgj20mc0d30t0.jpg" alt="shared element"></p>
<p>第二种使用场景是：在两个 Activity 间有两个不同的 View，我们通过过渡动画来将两个 View 联系起来，从而可以告诉用户应用完成了从一个页面到另一个页面的跳转。Transition Framework 会执行任何必要的任何动画。视觉效果还是非常棒的：</p>
<p><img src="http://ww1.sinaimg.cn/large/9db97af6gy1g188bhmv2eg20a80i6h79.gif" alt="share element anim"></p>
<p>当然，这只是一个动画，View 并没有从前一个 Layout 移动到后一个 Layout，他们是两个不同的 View。</p>
<p>使用方式：</p>
<p>1.启用 Window Content Transition</p>
<p>在 <code>styles.xml</code> 中设置 <code>android:windowContentTransitions</code> 为 <code>ture</code>。</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">style</span> <span class="attr">name</span>=<span class="string">"BaseTheme"</span> <span class="attr">parent</span>=<span class="string">"@style/Theme.AppCompat.Light.NoActionBar"</span>&gt;</span><span class="undefined"></span></div><div class="line"><span class="undefined">    ...</span></div><div class="line"><span class="xml">    <span class="tag">&lt;<span class="name">item</span> <span class="attr">name</span>=<span class="string">"android:windowContentTransitions"</span>&gt;</span>true<span class="tag">&lt;/<span class="name">item</span></span></span></div><div class="line"><span class="undefined">    ...</span></div><div class="line"><span class="undefined"></span><span class="tag">&lt;/<span class="name">style</span>&gt;</span></div></pre></td></tr></table></figure>
<p>顺带一提，如果你愿意的话，可以在这里设置整个 App 默认的 enter, exit 和 shared element transitions 。</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">style</span> <span class="attr">name</span>=<span class="string">"BaseTheme"</span> <span class="attr">parent</span>=<span class="string">"@style/Theme.AppCompat.Light.NoActionBar"</span>&gt;</span><span class="undefined"></span></div><div class="line"><span class="undefined">    ...</span></div><div class="line"><span class="xml">    <span class="comment">&lt;!-- specify enter and exit transitions --&gt;</span></span></div><div class="line"><span class="xml">    <span class="tag">&lt;<span class="name">item</span> <span class="attr">name</span>=<span class="string">"android:windowEnterTransition"</span>&gt;</span>@transition/explode<span class="tag">&lt;/<span class="name">item</span>&gt;</span></span></div><div class="line"><span class="xml">    <span class="tag">&lt;<span class="name">item</span> <span class="attr">name</span>=<span class="string">"android:windowExitTransition"</span>&gt;</span>@transition/explode<span class="tag">&lt;/<span class="name">item</span>&gt;</span></span></div><div class="line"><span class="undefined"></span></div><div class="line"><span class="xml">    <span class="comment">&lt;!-- specify shared element transitions --&gt;</span></span></div><div class="line"><span class="xml">    <span class="tag">&lt;<span class="name">item</span> <span class="attr">name</span>=<span class="string">"android:windowSharedElementEnterTransition"</span>&gt;</span>@transition/changebounds<span class="tag">&lt;/<span class="name">item</span>&gt;</span></span></div><div class="line"><span class="xml">    <span class="tag">&lt;<span class="name">item</span> <span class="attr">name</span>=<span class="string">"android:windowSharedElementExitTransition"</span>&gt;</span>@transition/changebounds<span class="tag">&lt;/<span class="name">item</span>&gt;</span></span></div><div class="line"><span class="undefined">    ...</span></div><div class="line"><span class="undefined"></span><span class="tag">&lt;/<span class="name">style</span>&gt;</span></div></pre></td></tr></table></figure>
<p>2.在两个 View 的布局属性中使用相同的 <code>android:transitionName</code>。</p>
<blockquote>
<p>layout/activity_a.xml</p>
</blockquote>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">ImageView</span></span></div><div class="line"><span class="tag">        <span class="attr">android:id</span>=<span class="string">"@+id/small_blue_icon"</span></span></div><div class="line"><span class="tag">        <span class="attr">style</span>=<span class="string">"@style/MaterialAnimations.Icon.Small"</span></span></div><div class="line"><span class="tag">        <span class="attr">android:src</span>=<span class="string">"@drawable/circle"</span></span></div><div class="line"><span class="tag">        <span class="attr">android:transitionName</span>=<span class="string">"@string/blue_name"</span> /&gt;</span></div></pre></td></tr></table></figure>
<blockquote>
<p>layout/activity_b.xml</p>
</blockquote>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">ImageView</span></span></div><div class="line"><span class="tag">        <span class="attr">android:id</span>=<span class="string">"@+id/big_blue_icon"</span></span></div><div class="line"><span class="tag">        <span class="attr">style</span>=<span class="string">"@style/MaterialAnimations.Icon.Big"</span></span></div><div class="line"><span class="tag">        <span class="attr">android:src</span>=<span class="string">"@drawable/circle"</span></span></div><div class="line"><span class="tag">        <span class="attr">android:transitionName</span>=<span class="string">"@string/blue_name"</span> /&gt;</span></div></pre></td></tr></table></figure>
<p>3.使用 shared element 启动另一个 Activity</p>
<p>使用 <code>ActivityOptions.makeSceneTransitionAnimation()</code> 并传入 origin view 以及步骤二中定义的 transition name。</p>
<blockquote>
<p>MainActivity.java</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line">blueIconImageView.setOnClickListener(<span class="keyword">new</span> View.OnClickListener() &#123;</div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onClick</span><span class="params">(View v)</span> </span>&#123;</div><div class="line">        Intent i = <span class="keyword">new</span> Intent(MainActivity.<span class="keyword">this</span>, SharedElementActivity.class);</div><div class="line"></div><div class="line">        View sharedView = blueIconImageView;</div><div class="line">        String transitionName = getString(R.string.blue_name);</div><div class="line"></div><div class="line">        ActivityOptions transitionActivityOptions = ActivityOptions.makeSceneTransitionAnimation(MainActivity.<span class="keyword">this</span>, sharedView, transitionName);</div><div class="line">        startActivity(i, transitionActivityOptions.toBundle());</div><div class="line">    &#125;</div><div class="line">&#125;);</div></pre></td></tr></table></figure>
<p>正如我们在前面所看到的动画，Transition Framework 会执行必要的动画，给人一种 View 从 Activity A 移动到了 Activity B 的错觉。</p>
<p>4.在 Fragment 间使用 shared element</p>
<p>只需要在 <code>FragmentTransaction</code> 切换 Fragment 时调用 <code>addSharedElement</code> 并将 origin view 和 transition name 传进去。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line">FragmentB fragmentB = FragmentB.newInstance(sample);</div><div class="line"></div><div class="line"><span class="comment">// Defines enter transition for all fragment views</span></div><div class="line">Slide slideTransition = <span class="keyword">new</span> Slide(Gravity.RIGHT);</div><div class="line">slideTransition.setDuration(<span class="number">1000</span>);</div><div class="line">sharedElementFragment2.setEnterTransition(slideTransition);</div><div class="line"></div><div class="line"><span class="comment">// Defines enter transition only for shared element</span></div><div class="line">ChangeBounds changeBoundsTransition = TransitionInflater.from(<span class="keyword">this</span>).inflateTransition(R.transition.change_bounds);</div><div class="line">fragmentB.setSharedElementEnterTransition(changeBoundsTransition);</div><div class="line"></div><div class="line">getFragmentManager().beginTransaction()</div><div class="line">        .replace(R.id.content, fragmentB)</div><div class="line">        .addSharedElement(blueView, getString(R.string.blue_name))</div><div class="line">        .commit();</div></pre></td></tr></table></figure>
<h2 id="3-通过-Transition-实现-View-动画"><a href="#3-通过-Transition-实现-View-动画" class="headerlink" title="3. 通过 Transition 实现 View 动画"></a>3. 通过 Transition 实现 View 动画</h2><p>使用 Transition 给 View 添加动画有两种方式：一种是改变 Scene，另一种是改变 View 的布局。</p>
<p>下面依次介绍</p>
<h3 id="Scenes"><a href="#Scenes" class="headerlink" title="Scenes"></a>Scenes</h3><p>Transition 可以发生在不同的 Scene 间，一个 Scene 只是一个静态的布局。当你从一个 Scene 切换到另一个 Scene 时，Transition Framework 会根据你传入的 transition 在 View 间执行必要的动画。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// 定义一些不用的 Scene</span></div><div class="line">scene1 = Scene.getSceneForLayout(sceneRoot, R.layout.activity_animations_scene1, <span class="keyword">this</span>);</div><div class="line">scene2 = Scene.getSceneForLayout(sceneRoot, R.layout.activity_animations_scene2, <span class="keyword">this</span>);</div><div class="line">scene3 = Scene.getSceneForLayout(sceneRoot, R.layout.activity_animations_scene3, <span class="keyword">this</span>);</div><div class="line">scene4 = Scene.getSceneForLayout(sceneRoot, R.layout.activity_animations_scene4, <span class="keyword">this</span>);</div><div class="line"></div><div class="line">(...)</div><div class="line"></div><div class="line"><span class="comment">// 从一个 Scene transition 到另一个 Scene</span></div><div class="line"><span class="meta">@Override</span></div><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onClick</span><span class="params">(View v)</span> </span>&#123;</div><div class="line">    <span class="keyword">switch</span> (v.getId()) &#123;</div><div class="line">        <span class="keyword">case</span> R.id.button1:</div><div class="line">            TransitionManager.go(scene1, <span class="keyword">new</span> ChangeBounds());</div><div class="line">            <span class="keyword">break</span>;</div><div class="line">        <span class="keyword">case</span> R.id.button2:</div><div class="line">            TransitionManager.go(scene2, TransitionInflater.from(<span class="keyword">this</span>).inflateTransition(R.transition.slide_and_changebounds));</div><div class="line">            <span class="keyword">break</span>;</div><div class="line">        <span class="keyword">case</span> R.id.button3:</div><div class="line">            TransitionManager.go(scene3, TransitionInflater.from(<span class="keyword">this</span>).inflateTransition(R.transition.slide_and_changebounds_sequential));</div><div class="line">            <span class="keyword">break</span>;</div><div class="line">        <span class="keyword">case</span> R.id.button4:</div><div class="line">            TransitionManager.go(scene4, TransitionInflater.from(<span class="keyword">this</span>).inflateTransition(R.transition.slide_and_changebounds_sequential_with_interpolators));</div><div class="line">            <span class="keyword">break</span>;  </div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>Transition Framework 将获取当前 Scene 中的所有可见视图，并计算和执行下一个 Scene 排列这些视图所需的任何必要动画。效果如下：</p>
<p><img src="http://ww1.sinaimg.cn/large/9db97af6gy1g18c5o0i4rg20a80i67k5.gif" alt="scenes anim"></p>
<h3 id="Layout-changes"><a href="#Layout-changes" class="headerlink" title="Layout changes"></a>Layout changes</h3><p>除了运用在  Scene 间外，Transition Framework 还可以为 View 的布局属性更改设置动画。我们只需要对 View 的布局属性进行更改，它就会执行必要的动画。步骤如下：</p>
<p>1.通知 Transition Framework</p>
<p>只需要这一行代码，Transition Framework 就会知道我们将要对 <code>sceneRoot</code> 中的 View  布局属性进行修改，当我们修改后，它会执行相应的动画。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">TransitionManager.beginDelayedTransition(sceneRoot);</div></pre></td></tr></table></figure>
<p>2.修改 View 的布局属性</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">ViewGroup.LayoutParams params = greenIconView.getLayoutParams();</div><div class="line">params.width = <span class="number">200</span>;</div><div class="line">greenIconView.setLayoutParams(params);</div></pre></td></tr></table></figure>
<p>在这一步我们修改了 <code>greenIconView</code> 的布局属性，这将会触发 <code>layoutMeasure</code>。Transition Framework 将会执行一个动画，让布局从初始状态转变到我们修改后的状态。效果如下：</p>
<p><img src="http://ww1.sinaimg.cn/large/9db97af6gy1g18cj4r10qg20a80i6gvp.gif" alt="view layout anim"></p>
<p><strong>全文完</strong></p>
<p><strong>感谢阅读</strong></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://androidhot.github.io/2019/02/03/2019-02-03-2018_read_books/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Zhiwei Li">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="https://avatars3.githubusercontent.com/u/17120655?v=4&u=d17931ce5e11210e09e2caf8140a7cba9fe60a71&s=400">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="假装在香港">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2019/02/03/2019-02-03-2018_read_books/" itemprop="url">我们这群人有种心病，只有金子能医</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2019-02-03T22:22:22+08:00">
                2019-02-03
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Reading/" itemprop="url" rel="index">
                    <span itemprop="name">Reading</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>本文是对 2018 年读书的一个总结，写这篇文章的时候正读完「人类简史」这本书，「人类简史」非常棒，读的过程中和读完后都思绪万千，特别想写点东西。今天正值除夕的前一天，此刻我正在回家的动车上，趁着想写东西的这股劲，对去年读过的书做一个总结。</p>
<p>2018 年后半年才开始读书。陆陆续续读了七本，按照先后顺序分别是：</p>
<ul>
<li>霍乱时期的爱情</li>
<li>一九八四</li>
<li>月亮与六便士</li>
<li>嫌疑人 X 的献身</li>
<li>东方快车谋杀案</li>
<li>万历十五年</li>
<li>人类简史</li>
</ul>
<p>这七本都是非常棒的书，在详细说每本书之前，我想先推荐一个节目：梁文道先生的「一千零一夜」。这是一个读书类的节目，内容是梁文道先生在北京夜晚的街道上给大家推荐经典书籍。内容做的非常的棒，梁文道先生也非常的棒。在现在这样一个浮躁的时代，能够静下心来做这样的一个节目，即便是有商业的成分在里面，也让人着实钦佩。</p>
<p>广告结束，进入今天的正菜。</p>
<h5 id="霍乱时期的爱情"><a href="#霍乱时期的爱情" class="headerlink" title="霍乱时期的爱情"></a>霍乱时期的爱情</h5><p>今年读的第一本非 CS 书是「霍乱时期的爱情」，这本书其实是以前买 CS 相关的书籍时凑满减买的，为啥买这本？当然是名字够文艺啦！🤣准备读这本书的时候已经在看「一千零一夜」这个节目了，当时在梁文道先生的熏陶下，觉得该利用闲暇时间多读读书了。就这样，我打开了「霍乱时期的爱情」。</p>
<p>从名字可以看出这是一本讲爱情的书，<strong>加西亚·马尔克斯</strong>的作品。「百年孤独」是他最出名的作品，但他却说「霍乱时期的爱情」是他最好的作品，是他出自内心的创作。这本书包含了爱情的全部答案，能够看到作者对爱情的诠释，能够看到爱情大部分的样子。读这本书，对爱情观会有一定的影响。</p>
<blockquote>
<p>我对死亡感到唯一的痛苦，是没能为爱而死。</p>
</blockquote>
<h5 id="一九八四"><a href="#一九八四" class="headerlink" title="一九八四"></a>一九八四</h5><p>「一九八四」是著名的反乌托邦政治隐喻小说，<strong>乔治·奥威尔</strong>的作品。这本书非常的出名，即使没有读过这本书的人也听过其名。小说描写了在极权专制统治下的国家是什么样子，很多场景看得人后背发凉。最让人感到恐惧的是，这本书里所描写的大多内容，在后来的很多国家里面都发生了。当然，我说的是朝鲜、韩国等国家。这本书的影响力非常的大，在很多国家甚至一度被列为禁书。并且这本书在梁文道先生的节目「一千零一夜」里面也有介绍，也是我今年看的这几本书里面唯一一本有被介绍到的。😄总之，非常棒的一本书。最后以一句广为流传的话结尾：</p>
<blockquote>
<p>多一个人看奥威尔，就多了一份自由的保障。</p>
</blockquote>
<h5 id="月亮与六便士"><a href="#月亮与六便士" class="headerlink" title="月亮与六便士"></a>月亮与六便士</h5><p>买这本书是因为当时为朋友挑选生日礼物，恰逢朋友正在为了考研而奋斗，在畅销榜看到了这本书，所以买了两本。送朋友一本，我自己一本（毕竟送给朋友的书不能自己没有看过吧😂）。这是一本讲理想的书，但学到更多的是关于自由和勇气。无论怎样，我们每个人都有选择一生中最想为之努力的东西的自由。这种自由只取决于我们自己，和世俗无关，和其他任何东西都无关。</p>
<blockquote>
<p>大多数人所成为的，并非是他们想成为的人，而是不得不成为的人。</p>
</blockquote>
<h5 id="嫌疑人-X-的献身"><a href="#嫌疑人-X-的献身" class="headerlink" title="嫌疑人 X 的献身"></a>嫌疑人 X 的献身</h5><p><strong>东野圭吾</strong>应该是这几年最火的日本作家了吧。2017 年毕业答辩之前，在学校用 Kindle 读了他最火的那部「白夜行」，惊为天人，是迄今为止是我最喜欢的悬疑小说（当然，目前为止我也没有看过几部悬疑小说😊）。17年下半年工作的时候又读了他另一部非常火的「解忧杂货店」，非常的温馨非常的棒，甚至让人感觉不到它出自悬疑小说家东野圭吾之手。时间来到 2018 年，我翻开了他的「嫌疑人 X 的献身」。还是非常棒的一部悬疑推理小说，人物塑造丰满，剧情设计巧妙。但对我来说唯一的遗憾是，在 2017 年 4 月份的时候我看了苏有朋根据这本书翻牌电影，导致我看这本书的时候，脑海里总是会将演员的脸谱带入，并且提前知道了剧情的走向，两个因素加在一起影响了读书的感觉。所以，还是要先看原著啊。</p>
<blockquote>
<p>他们就像时钟里没用的齿轮，每天都重复无意义的生活。</p>
</blockquote>
<h5 id="东方快车谋杀案"><a href="#东方快车谋杀案" class="headerlink" title="东方快车谋杀案"></a>东方快车谋杀案</h5><p>2018年 11 月 19 日，我到深圳出差的第一天。第一次来深圳，所以每到周末便会在深圳到处走走，感受一下这座城市。在人山人海的市民广场看灯光秀的那一晚，对这座城市心动了；当沿着深圳湾公园走到深圳人才公园时，我喜欢上了这座城市；在喜欢了七八年却从来没有去过的香港游玩了一天回到深圳地铁上后，我彻底爱上了这座城市。深圳，真是个令人着迷的地方。</p>
<p>在某个下雨的星期天，我在深圳图书馆旁边的深圳书城待了一天，找了一本短篇侦探小说「东方快车谋杀案」来读，英国著名的侦探小说家<strong>阿加莎·克里斯蒂</strong>的作品。虽然此前没有读过阿婆的作品，但是阿婆的名声却早有耳闻。15年的时候看过 BBC 根据她的同名小说改编的电视剧「无人生还」。<br>「东方快车谋杀案」，嗯，名字够吸引人，并且也非常有名气，经常能听到它的大名（最近在电视剧「大江大河」中就又出现了这本书）。读起来非常流畅，剧情不落俗套。美中不足的是个人感觉翻译的没有那么好。所以，还是要提高知识水平然后读原著啊。</p>
<blockquote>
<p>世界上没有绝对的正义，但人性本身总有转机。</p>
</blockquote>
<h5 id="万历十五年"><a href="#万历十五年" class="headerlink" title="万历十五年"></a>万历十五年</h5><p>「万历十五年」不同于其他历史书，读来非常有趣。黄仁宇先生文笔非常的好，透过万历执政时期的几个人物（万历皇帝、张居正、申时行、海瑞、戚继光、李贽）来讲历史。读此书我感想之一便是：时至今日我们国家的法律在某些方面还是非常不完善，依然依靠家庭、道德来处理一些本该依靠法律来解决的事。我文笔拙劣，无法用言语表达对此书对喜爱，选了一些豆瓣网友的书评贴在这：</p>
<ul>
<li>以古看今之极品。原来中国的那么多问题，五百年前未解决，五百年后依然未解决。谁说社会一定是进步的？</li>
<li>用张居正申时行讲政治 用海瑞讲经济 用戚继光讲军事 用李贽讲思想界 线索一气呵成 事实充分 见解透彻清晰。看带学术性质的书会有点费劲 看的很慢 会想很多 但是收获很多 感觉这本书给 中国历代政治得失打了基础。</li>
<li>纵观全书，每位人物都力图转变，却都陷入了一个怪圈——被文官集团钳制，以致整个王朝发展在万历十五年几近停滞。“以史为鉴，可以知兴替。”</li>
<li>作为一名文科生，可叹在曾经的受教育过程中，名字和历史事件都只作为应试时选择和填空的关键词，丝毫不能体会读史的意义。更唏嘘的是，除了朝代更迭，根子里的东西千百年来没有变过。</li>
<li>皇帝每天起床比现在的上班族还要早 北京又那么冷 被海瑞骂完把奏折摔在地上 过了一会又默默捡了起来 以前被电视剧灌输的那种皇帝就像“霸道总裁”一样屌炸天的印象终于破除了</li>
</ul>
<p>读历史还是不能只靠这教材这种东西啊。非常棒的一本书，以原书的结尾来做结尾：</p>
<blockquote>
<p>当一个人口众多的国家，各人行动全凭儒家简单粗浅而又无法固定的原则所限制，而法律又缺乏创造性，则其社会发展的程度，必然受到限制。即便是宗旨善良，也不能补助技术之不及。1587 年，是为万历十五年，丁亥次岁，表面上似乎是四海升平，无事可记，实际上我们的大明帝国却已经走到了它发展的尽头。在这个时候，皇帝的励精图治或者宴安耽乐，首辅的独裁或者调和，高级将领的富于创造或者习于苟安，文官的廉洁奉公或者贪污舞弊，思想家的极端进步或者绝对保守，最后的结果，都是无分善恶，统统不能在事业上取得有意义的发展，有的身败，有的名裂，还有的人则身败而兼名裂。</p>
<p>因此我们的故事只好在这里作悲剧性的结束。万历丁亥年的年鉴，是为历史上一部失败的总记录。</p>
</blockquote>
<h5 id="人类简史"><a href="#人类简史" class="headerlink" title="人类简史"></a>人类简史</h5><p>和「万历十五年」一样，「人类简史」也是一部非常非常有趣的历史书。作者带我们以上帝视角看了一遍整个人类的发展史：从认知革命智人崛起到农业革命，接着从工业革命到科学革命。涉及面也非常广：从帝国到宗教，再到科学和经济。尤老师十分有才华，文风十分的好，读整本书都让人感觉十分轻松愉悦。并且提出的很多观点也非常的新奇，带我们以一种全新的角度来看人类的大历史。</p>
<p>读这本书感触是非常多的。</p>
<ul>
<li>在整本书中都能感受到作者对天下大众（包括智人和所有在地球上<strong>生活过</strong>的动物）的“无边大爱”。</li>
<li>这个宇宙中根本没有神、国家、钱、人权、法律，也没有正义。国家、民族、公司等我们耳熟能详的东西，都只是智人想象出来的。这些东西并不是<strong>客观</strong>存在的，但同时这些东西也不是仅仅存在于某个<strong>主体</strong>的主观认识中，而是存在于<strong>主体之间</strong>。是大家都相信存在，它就存在。所以即便这些东西只是人类想象出来的，但也只有全人类（或者大部分）都不再相信它，才会有所改变。</li>
<li>欧洲在15世纪之后之所以能够崛起，在于当时的欧洲人愿意承认自己的无知。现代科学之所以能够蓬勃发展，仍然在于人类愿意承认自己的无知。</li>
<li>荷兰、英国等欧洲国家在掌握了航海技术以及相关武器技术后，殖民地遍布全球，当上了真正的世界霸主。在荷兰英国称霸世界之前，明朝的郑和便已经能够乘船去往印度。但由于大明朝并不在乎航海技术，导致 1840 年大清朝被大英帝国打得鸡飞狗跳（这里让人联想到「万历十五年」，我们国家在近现代的悲剧，其实早在明朝就埋下了伏笔。）。曾经我一度怀疑像我们这样的发展中国家将那么多钱用于航天事业而不是改善民生是否合理。直到读此书，读到这让人伤感的一八四零年。我们曾失去大海，并付出了沉重的代价，我们不能再失去太空。</li>
<li>……</li>
</ul>
<p>嗯，「人类简史」真的是非常棒的一本书。</p>
<h5 id="结尾"><a href="#结尾" class="headerlink" title="结尾"></a>结尾</h5><p>今年看过的七本书都非常的好，最喜欢的三本是：一九八四、万历十五年、人类简史。（排名仅按阅读的先后顺序）经过这半年的阅读，发现读书不仅能够修身养性陶冶情操，还能拓宽人的视野和知识面，还可以对自己的思想进行自我改造和换血，以及培养自我思考的能力。总之，读书真的是很棒的一件事。</p>
<p>咱们2019年年末再见。</p>
<p><strong>全文完</strong></p>
<p><strong>感谢阅读</strong></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://androidhot.github.io/2019/01/27/2019-01-27-Use_cppFlags_in_Gradle/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Zhiwei Li">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="https://avatars3.githubusercontent.com/u/17120655?v=4&u=d17931ce5e11210e09e2caf8140a7cba9fe60a71&s=400">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="假装在香港">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2019/01/27/2019-01-27-Use_cppFlags_in_Gradle/" itemprop="url">在 Gradle 中使用 cppFlags</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2019-01-27T22:08:29+08:00">
                2019-01-27
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Android/" itemprop="url" rel="index">
                    <span itemprop="name">Android</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>在 build.gradle 的 defaultConfig - externalNativeBuild - cmake 下有一个 cppFlags 的配置项。它的作用是定义 C++ 编译时的 flags：</p>
<figure class="highlight gradle"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line">android &#123;</div><div class="line">    <span class="comment">// Similar to other properties in the defaultConfig block, you can override</span></div><div class="line">    <span class="comment">// these properties for each product flavor in your build configuration.</span></div><div class="line">    defaultConfig &#123;</div><div class="line">        externalNativeBuild &#123;</div><div class="line">            cmake &#123;</div><div class="line">                <span class="comment">// Sets optional flags for the C++ compiler.</span></div><div class="line">                cppFlags <span class="string">"-fexceptions"</span>, <span class="string">"-frtti"</span></div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>除了可以像上述代码一样启用 RTTI 和 C++ 异常支持外，还可以加入一些自定义的宏，以方便在 C++ 代码中做不同的逻辑处理。例如我们在 C++ 中有如下代码：<br><figure class="highlight cpp"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#<span class="meta-keyword">define</span> ANDROID_SUPPORT_X_FEATURE</span></div><div class="line">    <span class="comment">// logic</span></div><div class="line"><span class="meta">#<span class="meta-keyword">else</span></span></div><div class="line">    <span class="comment">// logic</span></div><div class="line"><span class="meta">#<span class="meta-keyword">endif</span></span></div></pre></td></tr></table></figure></p>
<p>此时，在 build.gradle 中我们可以根据逻辑需要来决定是否在 cppFlags 中加入自定义的宏”-DANDROID_SUPPORT_X_FEATURE”，从而让 C++ 层执行不同的代码。</p>
<p>当然，这只是最基础的用法。还有一些场景除了需要知道是否定义了宏，还需要使用该宏的值。例如我们想使用数值型的值：</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#<span class="meta-keyword">ifdef</span> ANDROID_BUILD_NUMBER</span></div><div class="line">    <span class="keyword">int</span> build_number = ANDROID_BUILD_NUMBER;</div><div class="line">    <span class="comment">// ...</span></div><div class="line"><span class="meta">#<span class="meta-keyword">endif</span></span></div></pre></td></tr></table></figure>
<p>此时，在 build.gradle 中我们可以加入带值的 Flag:</p>
<figure class="highlight gradle"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">def</span> flags = <span class="string">""</span></div><div class="line"><span class="comment">// ...</span></div><div class="line">flags = <span class="string">" -DANDROID_BUILD_NUMBER="</span> + buildNumber</div><div class="line"><span class="comment">// ...</span></div><div class="line">cppFlags flags</div></pre></td></tr></table></figure>
<p>带数值的 Flag 使用起来还是很简单的，写这篇文章的主要原因还是在使用字符串值的 Flag 时遇到了一些问题。</p>
<p>假设我们想使用字符串型的宏：</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#<span class="meta-keyword">ifdef</span> ANDROID_AUTH_API_SECRET</span></div><div class="line">    <span class="keyword">const</span> <span class="keyword">char</span>* api_secret = ANDROID_AUTH_API_SECRET;</div><div class="line">    <span class="comment">// ...</span></div><div class="line"><span class="meta">#<span class="meta-keyword">endif</span></span></div></pre></td></tr></table></figure>
<p>这时如果我们像上面定义数值型的 Flag 那样做，编译就通不过：<br><figure class="highlight gradle"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">def</span> flags = <span class="string">""</span></div><div class="line"><span class="comment">// ...</span></div><div class="line">flags = <span class="string">" -DANDROID_AUTH_API_SECRET="</span> + authSecret</div><div class="line"><span class="comment">// ...</span></div><div class="line">cppFlags flags</div></pre></td></tr></table></figure></p>
<p>因为这样生成出来的宏定义是下面这样的，没有双引号，显然是不正确的：</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#<span class="meta-keyword">define</span> ANDROID_AUTH_API_SECRET auth_secret_value</span></div></pre></td></tr></table></figure>
<p>所以理所当然的，我们在 gradle 中定义的时候通过转义符把双引号给它加上：</p>
<figure class="highlight gradle"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">def</span> flags = <span class="string">""</span></div><div class="line"><span class="comment">// ...</span></div><div class="line">flags = <span class="string">" -DANDROID_AUTH_API_SECRET=\"$&#123;authSecret&#125;\""</span></div><div class="line"><span class="comment">// ...</span></div><div class="line">cppFlags flags</div></pre></td></tr></table></figure>
<p>此时问题…还是没有解决(微笑)，通过编译报的错来看，还是和上面一样的原因，生成出来的宏定义还是没有字符串引号：</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#<span class="meta-keyword">define</span> ANDROID_AUTH_API_SECRET auth_secret_value</span></div></pre></td></tr></table></figure>
<p>最终通过查资料和测试，发现在 gradle 中定义的时候还得给字符串的双引号添加一个转义符：</p>
<figure class="highlight gradle"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">def</span> flags = <span class="string">""</span></div><div class="line"><span class="comment">// ...</span></div><div class="line">flags = <span class="string">" -DANDROID_AUTH_API_SECRET=\\\"$&#123;authSecret&#125;\\\""</span></div><div class="line"><span class="comment">// ...</span></div><div class="line">cppFlags flags</div></pre></td></tr></table></figure>
<p>这样最终生成出来的宏定义就是正确的了:</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#<span class="meta-keyword">define</span> ANDROID_AUTH_API_SECRET <span class="meta-string">"auth_secret_value"</span></span></div></pre></td></tr></table></figure>
<p><strong>全文完</strong></p>
<p><strong>感谢阅读</strong></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://androidhot.github.io/2018/12/20/2018-12-20-Get-Bitmap-from-SurfaceView/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Zhiwei Li">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="https://avatars3.githubusercontent.com/u/17120655?v=4&u=d17931ce5e11210e09e2caf8140a7cba9fe60a71&s=400">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="假装在香港">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/12/20/2018-12-20-Get-Bitmap-from-SurfaceView/" itemprop="url">从 SurfaceView 获取 Bitmap</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2018-12-20T19:13:29+08:00">
                2018-12-20
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Android/" itemprop="url" rel="index">
                    <span itemprop="name">Android</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>在做三摄算法集成项目的时候，因为手机有三个摄像头，所以存在两种不同的双摄人像模式，分别是 1 倍人像模式（以下简称 1x）和 2 倍光变人像模式（以下简称 2x）。我们没有在 App 层面使用同时打开两个 camera id 的方式来打开双摄，因为这样逻辑会稍微复杂，所以我们是在底层做了这件事，在上层我们只需要打开新增的 camera id，就可以同时打开两个摄像头。</p>
<p>由于项目需要，我在高通的 SnapdragonCamera App 的 Preview 中添加了 1x 和 2x 的切换按钮，效果类似 iPhone（双摄） 中 1x 和 2x 的切换。查看 SnapdragonCamera 的代码后，找到了一个简单的切换 Camera 的方式，就是直接修改 SharedPreferences 中的一个关于当前 Camera id 配置。</p>
<p>这么做之后，功能确实实现了，但是在切换的过程中，因为会释放资源再重新构建，所以预览会消失，在 UI 上看到的情况就是黑了一下。这种体验不怎么好，需要优化一下。经过和 PM 沟通后，最后决定的优化方案是在切换的过程中，在 UI 上展示上一次预览的最后一帧，并且加一个模糊效果。</p>
<p>在高通的 SnapdragonCamera 中使用的是 <a href="https://developer.android.com/reference/android/view/SurfaceView" target="_blank" rel="external">SurfaceView</a> 进行 Preview，因为 SurfaceView 不像 <a href="https://developer.android.com/reference/android/view/TextureView" target="_blank" rel="external">TextureView</a> 一样有 getBitmap() 方法，所以获取最后一帧这一点得想想怎么做。</p>
<p>一开我想的是在 Preview 的时候再加一个 ImageReader 或者 TextureView，但是这样会把问题搞的比较复杂，并且也不是很好的解决方案。所以还是想在现有的 SurfaceView 上做点文章。</p>
<p>通过上网查阅资料（这里再次吐槽一下百度，不管是使用中文还是英文，查资料都不太好使。推荐使用 Google 用英文关键字查询），发现了 <a href="https://developer.android.com/reference/android/view/PixelCopy" target="_blank" rel="external">PixelCopy</a> 这个好东西。</p>
<p>PixelCopy 是在 API level 24（Android 7.0 Nougat）中添加的，由于我们这个项目使用的是最新的 Android 9 Pie，所以使用这个 API 是没有问题的。下面是官网对它的介绍：</p>
<blockquote>
<p>Provides a mechanisms to issue pixel copy requests to allow for copy operations from Surface to Bitmap</p>
</blockquote>
<p>PixelCopy 提供了一种发出像素复制请求的机制，允许从 Surface 到 Bitmap 的复制操作。Perfect，我们要的就是这样的一种功能。</p>
<p>下面是使用 PixelCopy 从 SurfaceView 获取 Bitmap 的示例代码。</p>
<p>Java:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">public</span> Bitmap <span class="title">getBitmap</span><span class="params">(SurfaceView surfaceView)</span> </span>&#123;</div><div class="line">    Bitmap bitmap = Bitmap.createBitmap(surfaceView.getWidth(), surfaceView.getHeight(), Bitmap.Config.ARGB_8888);</div><div class="line">    </div><div class="line">    PixelCopy.request(surfaceView, bitmap, <span class="keyword">new</span> PixelCopy.OnPixelCopyFinishedListener() &#123;</div><div class="line">        <span class="meta">@Override</span></div><div class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onPixelCopyFinished</span><span class="params">(<span class="keyword">int</span> copyResult)</span></span>&#123;</div><div class="line">            <span class="keyword">if</span> (PixelCopy.SUCCESS == copyResult) &#123;</div><div class="line">                <span class="comment">// onSuccessCallback(bitmap)</span></div><div class="line">            &#125; <span class="keyword">else</span> &#123;</div><div class="line">                <span class="comment">// onErrorCallback()</span></div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">    &#125;, surfaceView.getHandler());</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>Kotlin：</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div></pre></td><td class="code"><pre><div class="line"></div><div class="line"><span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">getBitmap</span><span class="params">(surfaceView: <span class="type">SurfaceView</span>)</span></span> = Single.create&lt;Bitmap&gt; &#123;</div><div class="line">    <span class="keyword">val</span> bitmap = Bitmap.createBitmap(surfaceView.width, surfaceView.height, Bitmap.Config.ARGB_8888)</div><div class="line"></div><div class="line">    <span class="keyword">val</span> listener = PixelCopy.OnPixelCopyFinishedListener &#123; copyResult -&gt;</div><div class="line">        <span class="keyword">when</span> (copyResult) &#123;</div><div class="line">            PixelCopy.SUCCESS -&gt; &#123;</div><div class="line">                <span class="comment">// onSuccessCallback(bitmap)</span></div><div class="line">            &#125;</div><div class="line">            <span class="keyword">else</span> -&gt; &#123;</div><div class="line">                <span class="comment">// onErrorCallback()</span></div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    PixelCopy.request(surfaceView, bitmap, listener, surfaceView.handler)</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>在 onPixelCopyFinished 回调中，我们的 Bitmap 已经从 SurfaceView 获取到了 Bitmap。</p>
<p><strong>全文完</strong></p>
<p><strong>感谢阅读</strong></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://androidhot.github.io/2018/04/03/2018-04-03-ThreadPoolExecutor/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Zhiwei Li">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="https://avatars3.githubusercontent.com/u/17120655?v=4&u=d17931ce5e11210e09e2caf8140a7cba9fe60a71&s=400">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="假装在香港">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/04/03/2018-04-03-ThreadPoolExecutor/" itemprop="url">在 Android 中使用 ThreadPoolExecutor</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2018-04-03T22:29:29+08:00">
                2018-04-03
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Android/" itemprop="url" rel="index">
                    <span itemprop="name">Android</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>「阿里巴巴 Android 开发手册」中第 5.3 节对<strong>新建线程</strong>做了如下强制性要求：</p>
<blockquote>
<p>新建线程时，必须通过线程池提供（AsyncTask 或者 ThreadPoolExecutor 或者其他形式自定义的线程池），不允许在应用中自行显式创建线程。</p>
</blockquote>
<p>并对此做了如下的说明：</p>
<blockquote>
<p>使用线程池的好处是减少在创建和销毁线程上所花的时间以及系统资源的开销，解决资源不足的问题。如果不使用线程池，有可能造成系统创建大量同类线程而导致消耗完内存或者“过度切换”的问题。另外创建匿名线程不便于后续的资源使用分析，对性能分析等会造成困扰。</p>
</blockquote>
<p>嗯，有理有据，让人信服。接下来将介绍 Thread Pools, Thread Pool Executors 以及它们在 Android 中的使用。</p>
<p>先欣赏一张美丽的图片：</p>
<p><img src="https://ws1.sinaimg.cn/large/9db97af6gy1fpzp3le1nmj20m80dwtf8.jpg" alt="Thread Pool Executor"></p>
<h3 id="Thread-Pool"><a href="#Thread-Pool" class="headerlink" title="Thread Pool"></a>Thread Pool</h3><p>一个线程池（Thread Pool）管理着一些工作线程（work threads）（具体的数字取决于它的实现方式）。</p>
<p>任务队列（Task Queue）中存储着一些等待着被线程池中的空闲线程执行的任务，这些任务被生产者（producers）添加到队列中，线程池中的工作线程（work threads）充当消费者（consumers）。一旦线程池中有空闲线程准备好执行新的后台任务，它们便会执行（consuming）队列中的任务。</p>
<h3 id="ThreadPoolExecutor"><a href="#ThreadPoolExecutor" class="headerlink" title="ThreadPoolExecutor"></a>ThreadPoolExecutor</h3><p><strong>ThreadPoolExecutor</strong> 使用线程池中的一个线程去执行给定的 task。<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">public</span> <span class="title">ThreadPoolExecutor</span><span class="params">(<span class="keyword">int</span> corePoolSize, <span class="keyword">int</span> maximumPoolSize, <span class="keyword">long</span> keepAliveTime, TimeUnit unit, BlockingQueue&lt;Runnable&gt; workQueue)</span> </span>&#123;&#125;</div></pre></td></tr></table></figure></p>
<p>上面是 ThreadPoolExecutor 构造函数中的几个重要参数， 这些参数有什么含义？</p>
<ol>
<li><strong>corePoolSize</strong>：保留在线程池中的最小线程数，最初在线程池中只有 0 个线程，随着任务被添加到队列中，新线程便会被创建。规则：假设线程池中存在空闲的线程，但是池中线程数小于 corePoolSize，那么将会继续创建新的线程。</li>
<li><strong>maximumPoolSize</strong>：线程池中允许存在的最大线程数，如果 maximumPoolSize 大于 corePoolSize，并且当前池中的线程数大于等于 corePoolSize，那么只有当任务队列已满时才会创建新的线程。</li>
<li><strong>keepAliveTime</strong>：当池中线程的数量大于 core 数时，多余的空闲线程如果在该参数指定的时间内没有等待到一个新的任务，那么它们将会死掉。</li>
<li><strong>unit</strong>：参数 keepAliveTime 的单位。</li>
<li><strong>workQueue</strong>：上面提到的任务队列（task queue），它必须是一个 <a href="http://developer.android.com/reference/java/util/concurrent/BlockingQueue.html" target="_blank" rel="external">BlockingQueue</a>，并且只能存储 runnable tasks。</li>
</ol>
<h3 id="为什么要在-Android-中使用-ThreadPoolExecutor"><a href="#为什么要在-Android-中使用-ThreadPoolExecutor" class="headerlink" title="为什么要在 Android 中使用 ThreadPoolExecutor"></a>为什么要在 Android 中使用 ThreadPoolExecutor</h3><ul>
<li>ThreadPoolExecutor 是一个强大的任务执行框架，它支持任务添加、取消任务、给任务声明优先级等操作。</li>
<li>ThreadPoolExecutor 减少了与线程创建相关的开销，因为它在其线程池中管理了一定数量的线程。</li>
</ul>
<h3 id="在-Android-中使用-ThreadPoolExecutor"><a href="#在-Android-中使用-ThreadPoolExecutor" class="headerlink" title="在 Android 中使用 ThreadPoolExecutor"></a>在 Android 中使用 ThreadPoolExecutor</h3><p>首先创建 PriorityThreadFactory（将作为 ThreadPoolExecutor 的一个参数）：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">PriorityThreadFactory</span> <span class="keyword">implements</span> <span class="title">ThreadFactory</span> </span>&#123;</div><div class="line"></div><div class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="keyword">int</span> mThreadPriority;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="title">PriorityThreadFactory</span><span class="params">(<span class="keyword">int</span> threadPriority)</span> </span>&#123;</div><div class="line">        mThreadPriority = threadPriority;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="meta">@Override</span> <span class="function"><span class="keyword">public</span> Thread <span class="title">newThread</span><span class="params">(@NonNull <span class="keyword">final</span> Runnable runnable)</span> </span>&#123;</div><div class="line">        Runnable wrapperRunnable = <span class="keyword">new</span> Runnable() &#123;</div><div class="line">            <span class="meta">@Override</span> <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</div><div class="line">                <span class="keyword">try</span> &#123;</div><div class="line">                    Process.setThreadPriority(mThreadPriority);</div><div class="line">                &#125; <span class="keyword">catch</span> (Throwable t) &#123;</div><div class="line"></div><div class="line">                &#125;</div><div class="line">                runnable.run();</div><div class="line">            &#125;</div><div class="line">        &#125;;</div><div class="line">        <span class="keyword">return</span> <span class="keyword">new</span> Thread(wrapperRunnable);</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>创建 MainThreadExecutor（用于执行主线程中的 tasks）：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MainThreadExecutor</span> <span class="keyword">implements</span> <span class="title">Executor</span> </span>&#123;</div><div class="line"></div><div class="line">    <span class="keyword">private</span> Handler mHandler = <span class="keyword">new</span> Handler(Looper.getMainLooper());</div><div class="line"></div><div class="line">    <span class="meta">@Override</span> <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">execute</span><span class="params">(@NonNull Runnable runnable)</span> </span>&#123;</div><div class="line">        mHandler.post(runnable);</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>创建 DefaultExecutorSupplier（构建、管理不同的 ThreadPoolExecutor ）</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">DefaultExecutorSupplier</span> </span>&#123;</div><div class="line">    <span class="comment">// 决定池中线程的数量</span></div><div class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> NUMBER_OF_CORES = Runtime.getRuntime().availableProcessors();</div><div class="line"></div><div class="line">    <span class="comment">// 用于后台任务的 ThreadPoolExecutor</span></div><div class="line">    <span class="keyword">private</span> <span class="keyword">final</span> ThreadPoolExecutor mForBackgroundTasks;</div><div class="line"></div><div class="line">    <span class="comment">// 用于轻量级后台任务的 ThreadPoolExecutor</span></div><div class="line">    <span class="keyword">private</span> <span class="keyword">final</span> ThreadPoolExecutor mForLightWeightBackgroundTasks;</div><div class="line"></div><div class="line">    <span class="comment">// 用于执行主线程中的 tasks</span></div><div class="line">    <span class="keyword">private</span> <span class="keyword">final</span> MainThreadExecutor mMainThreadExecutor;</div><div class="line"></div><div class="line">    <span class="comment">// DefaultExecutorSupplier 的一个实例</span></div><div class="line">    <span class="keyword">private</span> <span class="keyword">static</span> DefaultExecutorSupplier instance;</div><div class="line"></div><div class="line">    <span class="comment">// 利用单列模式返回 DefaultExecutorSupplier 的实例</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> DefaultExecutorSupplier <span class="title">getInstance</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="keyword">if</span> (instance == <span class="keyword">null</span>) &#123;</div><div class="line">            <span class="keyword">synchronized</span> (DefaultExecutorSupplier.class) &#123;</div><div class="line">                <span class="keyword">if</span> (instance == <span class="keyword">null</span>) &#123;</div><div class="line">                    instance = <span class="keyword">new</span> DefaultExecutorSupplier();</div><div class="line">                &#125;</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">return</span> instance;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="comment">// DefaultExecutorSupplier 的私有构造函数</span></div><div class="line">    <span class="function"><span class="keyword">private</span> <span class="title">DefaultExecutorSupplier</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="comment">// 设置 thread factory</span></div><div class="line">        ThreadFactory priorityThreadFactory = <span class="keyword">new</span> PriorityThreadFactory(Process.THREAD_PRIORITY_BACKGROUND);</div><div class="line"></div><div class="line">        <span class="comment">// 构建用于后台任务的 mForBackgroundTasks</span></div><div class="line">        mForBackgroundTasks = <span class="keyword">new</span> ThreadPoolExecutor(NUMBER_OF_CORES * <span class="number">2</span>,</div><div class="line">                NUMBER_OF_CORES * <span class="number">2</span>,</div><div class="line">                <span class="number">60L</span>,</div><div class="line">                TimeUnit.SECONDS,</div><div class="line">                <span class="keyword">new</span> LinkedBlockingQueue&lt;Runnable&gt;(),</div><div class="line">                priorityThreadFactory);</div><div class="line"></div><div class="line">        <span class="comment">// 构建用于轻量级后台任务的 mForLightWeightBackgroundTasks</span></div><div class="line">        mForLightWeightBackgroundTasks = <span class="keyword">new</span> ThreadPoolExecutor(NUMBER_OF_CORES,</div><div class="line">                NUMBER_OF_CORES * <span class="number">2</span>,</div><div class="line">                <span class="number">60L</span>,</div><div class="line">                TimeUnit.SECONDS,</div><div class="line">                <span class="keyword">new</span> LinkedBlockingQueue&lt;Runnable&gt;(),</div><div class="line">                priorityThreadFactory);</div><div class="line"></div><div class="line">        <span class="comment">// 构建 mMainThreadExecutor</span></div><div class="line">        mMainThreadExecutor = <span class="keyword">new</span> MainThreadExecutor();</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> ThreadPoolExecutor <span class="title">forBackgroundTasks</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="keyword">return</span> mForBackgroundTasks;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> ThreadPoolExecutor <span class="title">forLightWeightBackgroundTasks</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="keyword">return</span> mForLightWeightBackgroundTasks;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> Executor <span class="title">forMainThreadTasks</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="keyword">return</span> mMainThreadExecutor;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>PS：corePoolSize 和 maximumPoolSize 请根据自己的时间需求进行设置。</p>
<p><strong>现在，在你的代码中使用它吧！</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// 将它用于后台任务</span></div><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">doSomeBackgroundWork</span><span class="params">()</span></span>&#123;</div><div class="line">  DefaultExecutorSupplier.getInstance().forBackgroundTasks()</div><div class="line">    .execute(<span class="keyword">new</span> Runnable() &#123;</div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</div><div class="line">       <span class="comment">// do some background work here.</span></div><div class="line">    &#125;</div><div class="line">  &#125;);</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="comment">// 将它用于轻量级后台任务</span></div><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">doSomeLightWeightBackgroundWork</span><span class="params">()</span></span>&#123;</div><div class="line">  DefaultExecutorSupplier.getInstance().forLightWeightBackgroundTasks()</div><div class="line">    .execute(<span class="keyword">new</span> Runnable() &#123;</div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</div><div class="line">       <span class="comment">// do some light-weight background work here.</span></div><div class="line">    &#125;</div><div class="line">  &#125;);</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="comment">// 将它用于主线程的任务</span></div><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">doSomeMainThreadWork</span><span class="params">()</span></span>&#123;</div><div class="line">  DefaultExecutorSupplier.getInstance().forMainThreadTasks()</div><div class="line">    .execute(<span class="keyword">new</span> Runnable() &#123;</div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</div><div class="line">       <span class="comment">// do some Main Thread work here.</span></div><div class="line">    &#125;</div><div class="line">  &#125;);</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>通过这种方式，我们可以为网络任务， I/O 操作，耗时的后台任务等创建不同的线程池。enjoy it.</p>
<h3 id="如何取消一个任务"><a href="#如何取消一个任务" class="headerlink" title="如何取消一个任务"></a>如何取消一个任务</h3><p>为了取消一个任务，应该使用 submit 方法而不是 execute，它将返回一个 future 对象，使用该返回值可以取消任务。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// 通过将任务 submitting 到线程池中来得到 future</span></div><div class="line">Future future = DefaultExecutorSupplier.getInstance().forBackgroundTasks()</div><div class="line">    .submit(<span class="keyword">new</span> Runnable() &#123;</div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</div><div class="line">      <span class="comment">// do some background work here.</span></div><div class="line">    &#125;</div><div class="line">&#125;);</div><div class="line"></div><div class="line"><span class="comment">// 取消这个 task</span></div><div class="line">future.cancel(<span class="keyword">true</span>);</div></pre></td></tr></table></figure>
<p><strong>全文完</strong></p>
<p><strong>感谢阅读</strong></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://androidhot.github.io/2018/03/13/2018-03-13-Stack-implement-Queue/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Zhiwei Li">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="https://avatars3.githubusercontent.com/u/17120655?v=4&u=d17931ce5e11210e09e2caf8140a7cba9fe60a71&s=400">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="假装在香港">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/03/13/2018-03-13-Stack-implement-Queue/" itemprop="url">两个栈实现一个队列</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2018-03-13T22:16:16+08:00">
                2018-03-13
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Algorithms/" itemprop="url" rel="index">
                    <span itemprop="name">Algorithms</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>之前面试的时候被面试官问到一道算法题：如何用两个栈实现一个队列。我的回答是，把所有元素：入第一个栈 -&gt; 从第一个栈出栈并入第二个栈 -&gt; 从第二个栈出栈。当时无知，以为自己的回答是正确的，但是面试官接下来的问题便把我给打回原形了：如果想要队列是可以同时入队列和出队列的呢。</p>
<p>最近在学习《算法导论》，学习到了栈和队列这一章，又想起了上面的问题，便重新思考和 Coding 了一番，顺便记录一下。</p>
<h3 id="栈"><a href="#栈" class="headerlink" title="栈"></a>栈</h3><blockquote>
<p>栈（stack）又名堆栈，它是一种运算受限的线性表。其限制是仅允许在表的一端进行插入和删除运算。这一端被称为栈顶，相对地，把另一端称为栈底。向一个栈插入新元素又称作进栈、入栈或压栈，它是把新元素放到栈顶元素的上面，使之成为新的栈顶元素；从一个栈删除元素又称作出栈或退栈，它是把栈顶元素删除掉，使其相邻的元素成为新的栈顶元素。</p>
</blockquote>
<p>从上面这段关于栈的介绍我们可以知道栈的基本特点：<strong>先入后出，后入先出（LIFO, Last In First Out）。</strong> </p>
<p><img src="https://ws1.sinaimg.cn/large/9db97af6gy1fpbc1tkxumj20av07tq2r.jpg" alt="stack 图示"></p>
<p>下面是用 Python 中的 list 实现的一个 Stack，主要依靠 <em>self.top</em> 这个变量来定位栈顶元素以及判断是否 stack overflow, stack underflow。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div></pre></td><td class="code"><pre><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">Stack</span><span class="params">(object)</span>:</span></div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, length)</span>:</span></div><div class="line">        self.S = [<span class="keyword">None</span> <span class="keyword">for</span> _ <span class="keyword">in</span> range(length)]</div><div class="line">        self.top = <span class="number">-1</span></div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">def</span> <span class="title">stack_empty</span><span class="params">(self)</span>:</span></div><div class="line">        <span class="keyword">if</span> self.top == <span class="number">-1</span>:</div><div class="line">            <span class="keyword">return</span> <span class="keyword">True</span></div><div class="line">        <span class="keyword">else</span>:</div><div class="line">            <span class="keyword">return</span> <span class="keyword">False</span></div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">def</span> <span class="title">push</span><span class="params">(self, element)</span>:</span></div><div class="line">        <span class="keyword">if</span> self.top + <span class="number">1</span> == len(self.S):</div><div class="line">            <span class="keyword">raise</span> IndexError(<span class="string">'stack overflow'</span>)</div><div class="line">        <span class="keyword">else</span>:</div><div class="line">            self.top = self.top + <span class="number">1</span></div><div class="line">            self.S[self.top] = element</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">def</span> <span class="title">pop</span><span class="params">(self)</span>:</span></div><div class="line">        <span class="keyword">if</span> self.stack_empty():</div><div class="line">            <span class="keyword">raise</span> IndexError(<span class="string">'stack underflow'</span>)</div><div class="line">        <span class="keyword">else</span>:</div><div class="line">            self.top = self.top - <span class="number">1</span></div><div class="line">            <span class="keyword">return</span> self.S[self.top + <span class="number">1</span>]</div></pre></td></tr></table></figure>
<h3 id="队列"><a href="#队列" class="headerlink" title="队列"></a>队列</h3><blockquote>
<p>队列（queue）是一种特殊的线性表，特殊之处在于它只允许在表的前端（Front）进行删除操作，而在表的后端（Back）进行插入操作，和栈一样，队列是一种操作受限制的线性表。进行插入操作的端称为队尾，进行删除操作的端称为队头。</p>
</blockquote>
<p>从上面这段关于队列的介绍我们可以知道队列的基本特点：<strong>先入先出（First-In-First-Out），后入后出。</strong></p>
<p><img src="https://ws1.sinaimg.cn/large/9db97af6gy1fpbc3vszajj217q0tnabf.jpg" alt="queue 图示"></p>
<p>下面是用 Python 中的 list 实现的一个 Queue，主要依靠 <em>self.head, self.tail</em> 这两个变量来定位的队列的队头（head），队尾（tail）以及判断是否 queue overflow, queue underflow。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div></pre></td><td class="code"><pre><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">Queue</span><span class="params">(object)</span>:</span></div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, length)</span>:</span></div><div class="line">        self.Q = [<span class="keyword">None</span> <span class="keyword">for</span> _ <span class="keyword">in</span> range(length)]</div><div class="line">        self.head = <span class="number">0</span></div><div class="line">        self.tail = <span class="number">0</span></div><div class="line">        self.maxIndex = length - <span class="number">1</span></div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">def</span> <span class="title">enqueue</span><span class="params">(self, element)</span>:</span></div><div class="line">        <span class="keyword">if</span> self._isOverFlow():</div><div class="line">            <span class="keyword">raise</span> IndexError(<span class="string">'queue overflow.'</span>)</div><div class="line">        <span class="keyword">else</span>:</div><div class="line">            self.Q[self.tail] = element</div><div class="line">            <span class="keyword">if</span> self.tail == self.maxIndex:</div><div class="line">                self.tail = <span class="number">0</span></div><div class="line">            <span class="keyword">else</span>:</div><div class="line">                self.tail += <span class="number">1</span></div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">def</span> <span class="title">dequeue</span><span class="params">(self)</span>:</span></div><div class="line">        <span class="keyword">if</span> self._isUnderFlow():</div><div class="line">            <span class="keyword">raise</span> IndexError(<span class="string">'queue underflow.'</span>)</div><div class="line">        <span class="keyword">else</span>:</div><div class="line">            result = self.Q[self.head]</div><div class="line">            self.Q[self.head] = <span class="keyword">None</span></div><div class="line">            <span class="keyword">if</span> self.head == self.maxIndex:</div><div class="line">                self.head = <span class="number">0</span></div><div class="line">            <span class="keyword">else</span>:</div><div class="line">                self.head += <span class="number">1</span></div><div class="line">            <span class="keyword">return</span> result</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">def</span> <span class="title">_isOverFlow</span><span class="params">(self)</span>:</span></div><div class="line">        <span class="keyword">return</span> (self.head == self.tail) <span class="keyword">and</span> self.Q[self.head]</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">def</span> <span class="title">_isUnderFlow</span><span class="params">(self)</span>:</span></div><div class="line">        <span class="keyword">return</span> (self.head == self.tail) <span class="keyword">and</span> (<span class="keyword">not</span> self.Q[self.head])</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">def</span> <span class="title">onlyOneElement</span><span class="params">(self)</span>:</span></div><div class="line">        <span class="keyword">return</span> (self.tail - self.head == <span class="number">1</span>) <span class="keyword">or</span> (self.tail == <span class="number">0</span> <span class="keyword">and</span> self.head == self.maxIndex)</div></pre></td></tr></table></figure>
<h3 id="利用两个栈实现一个队列"><a href="#利用两个栈实现一个队列" class="headerlink" title="利用两个栈实现一个队列"></a>利用两个栈实现一个队列</h3><p>介绍完基础知识终于可以开始进入主题了：如何利用两个栈实现一个队列？</p>
<p>只要利用好上面提到的栈和队列的基本特点就可以很轻松的想出解决方案：</p>
<ul>
<li><p><strong>队列的入队</strong>：直接利用第一个栈的入栈操作来实现队列的入队。</p>
</li>
<li><p><strong>队列的出队</strong>：因为入队使用了非常简单的方式来实现，所以出队就需要稍微花点功夫了。</p>
<ol>
<li>出队的时候，因为想要的是将第一个栈中的栈底元素出队，所以首先我们需要将第一个栈中除了栈底元素外的其他元素弹出栈并且进入第二个栈中。</li>
<li>然后将第一个栈的栈底元素返回即可。</li>
<li>当然，为了保证后续的入栈出栈操作都正确，所以在上一步拿到栈底元素返回之前，需要将第二个栈中的元素全部弹出栈并且进入第一个栈中。这样第一个栈前后的变化仅仅是失去了原来的栈底元素，队列也顺利的完成了出队操作。</li>
</ol>
</li>
</ul>
<p>下面是利用两个 Stack （具体实现在上面的第一片代码中） 实现 Queue 的代码。基本上就是按照上面提到的步骤实现的。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">from</span> stack <span class="keyword">import</span> Stack</div><div class="line"></div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">Queue</span><span class="params">(object)</span>:</span></div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, length)</span>:</span></div><div class="line">        self.stack1 = Stack(length)</div><div class="line">        self.stack2 = Stack(length)</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">def</span> <span class="title">enqueue</span><span class="params">(self, element)</span>:</span></div><div class="line">        <span class="keyword">try</span>:</div><div class="line">            self.stack1.push(element)</div><div class="line">        <span class="keyword">except</span> IndexError:</div><div class="line">            <span class="keyword">raise</span> IndexError(<span class="string">'queue overflow.'</span>)</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">def</span> <span class="title">dequeue</span><span class="params">(self)</span>:</span></div><div class="line">        <span class="keyword">while</span> self.stack1.top &gt; <span class="number">0</span>:</div><div class="line">            self.stack2.push(self.stack1.pop())</div><div class="line">        <span class="keyword">try</span>:</div><div class="line">            result = self.stack1.pop()</div><div class="line">        <span class="keyword">except</span> IndexError:</div><div class="line">            <span class="keyword">raise</span> IndexError(<span class="string">'queue underflow.'</span>)</div><div class="line">        <span class="keyword">while</span> <span class="keyword">not</span> self.stack2.stack_empty():</div><div class="line">            self.stack1.push(self.stack2.pop())</div><div class="line">        <span class="keyword">return</span> result</div></pre></td></tr></table></figure>
<h3 id="利用两个队列实现一个栈"><a href="#利用两个队列实现一个栈" class="headerlink" title="利用两个队列实现一个栈"></a>利用两个队列实现一个栈</h3><p>延伸一下，既然已经有了利用两个栈实现一个队列的思路，那么同样的按照这个思路走就能利用两个队列实现一个栈啦。</p>
<ul>
<li><p><strong>入栈</strong>：利用两个队列中不为空的那一个队列的入队操作来实现栈的入栈。（如果两个都为空的话就随便哪一个）</p>
</li>
<li><p><strong>出栈</strong>：同样的，因为入栈使用了非常简单的方式来实现，所以出栈就需要稍微花点功夫了。（好像在哪里见过这句话？？？）</p>
<ol>
<li>出栈的时候，因为想要的是不为空的那一个队列中的队尾元素出队，所以首先我们需要将该队列中除了队尾元素外的其他元素出队并且进入另一个为空的队列中。</li>
<li>然后将该队列的队尾元素返回即可。</li>
<li><del>嗯，利用两个队列实现一个栈没有第三步，不信你重复上面两步试试对不对。</del></li>
</ol>
</li>
</ul>
<p>下面是利用两个 Queue （具体实现在上面的第二片代码中） 实现 Stack 的代码：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">from</span> queue <span class="keyword">import</span> Queue</div><div class="line"></div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">Stack</span><span class="params">(object)</span>:</span></div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, length)</span>:</span></div><div class="line">        self.queue1 = Queue(length)</div><div class="line">        self.queue2 = Queue(length)</div><div class="line">        self.usingQueue1Push = <span class="keyword">True</span></div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">def</span> <span class="title">push</span><span class="params">(self, element)</span>:</span></div><div class="line">        <span class="keyword">try</span>:</div><div class="line">            <span class="keyword">if</span> self.usingQueue1Push:</div><div class="line">                self.queue1.enqueue(element)</div><div class="line">            <span class="keyword">else</span>:</div><div class="line">                self.queue2.enqueue(element)</div><div class="line">        <span class="keyword">except</span> IndexError:</div><div class="line">            <span class="keyword">raise</span> IndexError(<span class="string">'stack overflow.'</span>)</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">def</span> <span class="title">pop</span><span class="params">(self)</span>:</span></div><div class="line">        <span class="keyword">try</span>:</div><div class="line">            <span class="keyword">if</span> self.usingQueue1Push:</div><div class="line">                <span class="keyword">while</span> <span class="keyword">not</span> self.queue1.onlyOneElement():</div><div class="line">                    self.queue2.enqueue(self.queue1.dequeue())</div><div class="line">                result = self.queue1.dequeue()</div><div class="line">            <span class="keyword">else</span>:</div><div class="line">                <span class="keyword">while</span> <span class="keyword">not</span> self.queue2.onlyOneElement():</div><div class="line">                    self.queue1.enqueue(self.queue2.dequeue())</div><div class="line">                result = self.queue2.dequeue()</div><div class="line">        <span class="keyword">except</span> IndexError:</div><div class="line">            <span class="keyword">raise</span> IndexError(<span class="string">'stack underflow.'</span>)</div><div class="line">        self.usingQueue1Push = <span class="keyword">not</span> self.usingQueue1Push</div><div class="line">        <span class="keyword">return</span> result</div></pre></td></tr></table></figure>
<p>源码地址：<a href="https://github.com/AndroidHot/Introduction-to-Algorithms/blob/master/chapter10/section1/stack_implements_queue.py" target="_blank" rel="external">Two stacks implement the queue.</a></p>
<p><strong>全文完</strong></p>
<p><strong>感谢阅读</strong></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://androidhot.github.io/2017/10/12/2017-10-12-Backpropagation/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Zhiwei Li">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="https://avatars3.githubusercontent.com/u/17120655?v=4&u=d17931ce5e11210e09e2caf8140a7cba9fe60a71&s=400">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="假装在香港">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/10/12/2017-10-12-Backpropagation/" itemprop="url">反向传播算法</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-10-12T21:20:16+08:00">
                2017-10-12
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Algorithms/" itemprop="url" rel="index">
                    <span itemprop="name">Algorithms</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="为什么要使用反向传播"><a href="#为什么要使用反向传播" class="headerlink" title="为什么要使用反向传播"></a>为什么要使用反向传播</h2><p>在监督学习中，比如线性回归、逻辑回归等问题中，在训练模型的过程中有很重要的一步就是对输入的权重（theta，又叫 W）不断的更新，以降低 Cost function 的输出值。在之前，我们都是通过是手动计算的方式去计算权重参数的偏导数。</p>
<p>在神经网络中，由于神经元的数目比较多，导致权重参数（theta）也会非常的多，在这样的情况下，手动计算权重参数的偏导数的方式已经不太适用了，并且由于函数的复杂性也很可能会导致计算出错。</p>
<p>那我们该怎么去计算所有权重参数的偏导数呢？</p>
<p>当然是利用我们今天要讲的「反向传播算法」啦！</p>
<h2 id="概念"><a href="#概念" class="headerlink" title="概念"></a>概念</h2><p>反向传播是利用<strong>链式法则</strong>递归计算表达式的梯度的方法。理解反向传播过程及其精妙之处，对于理解、实现、设计和调试神经网络非常关键。</p>
<h2 id="详解"><a href="#详解" class="headerlink" title="详解"></a>详解</h2><blockquote>
<p>牢记导数的意义：函数变量在某个点周围的极小区域内变化，而导数就是变量变化导致的函数在该方向上的变化率。换句话说，函数关于每个变量的导数指明了整个表达式对于该变量的敏感程度。</p>
</blockquote>
<p><strong>使用链式法则计算复合表达式</strong></p>
<p><img src="https://ws1.sinaimg.cn/large/9db97af6gy1fkfh2qvxxjj21ak0q34aj.jpg" alt="simple backpropagation example"></p>
<p>图中所示的函数非常简单，不能和我们平时遇到的非常庞大的 cost function 相提并论，在这里仅仅是为了方便介绍反向传播算法。</p>
<p>我们需要求的是函数关于 x、y、z 的导数，明眼人一眼就能看出来 x、y、z 的导数，但是我们要用反向传播的方法来计算。</p>
<p>如图所示，从尾部开始。首先我们会先计算 f 对 f 的导数，自己对自己求导，导数当然为 1。紧接着，我们会计算 f 对 z 的导数，很简单，导数是 3。同理 f 对 q 的导数是 -4。</p>
<p><strong>重点来了，接下来我们想要求解 f 对 x 的导数，怎么求？我们先计算 q 对 x 的导数，因为 q = x + y ，所以可以很容易的得到 q 对 x 的导数为 1，然后将 q 对 x 的导数 与 f 对 q 的导数相乘，便得到了 f 对 x 的导数。即： -4 * 1 = -4</strong></p>
<p>示例代码：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line"># 设置输入值</div><div class="line">x = -2; y = 5; z = -4</div><div class="line"></div><div class="line"># 进行前向传播</div><div class="line">q = x + y # q becomes 3</div><div class="line">f = q * z # f becomes -12</div><div class="line"></div><div class="line"># 进行反向传播:</div><div class="line"># 首先回传到 f = q * z</div><div class="line">dfdz = q # df/dz = q, 所以关于z的梯度是3</div><div class="line">dfdq = z # df/dq = z, 所以关于q的梯度是-4</div><div class="line"># 现在回传到q = x + y</div><div class="line">dfdx = 1.0 * dfdq # dq/dx = 1. 这里的乘法是因为链式法则</div><div class="line">dfdy = 1.0 * dfdq # dq/dy = 1</div></pre></td></tr></table></figure></p>
<p><img src="https://ws1.sinaimg.cn/large/9db97af6gy1fkfhl17je5j20go0523yr.jpg" alt="image"></p>
<blockquote>
<p>上图的真实值计算线路展示了计算的视觉化过程。<strong>前向传播</strong>从输入计算到输出（绿色），<strong>反向传播</strong>从尾部开始，根据<strong>链式法则</strong>递归地向前计算梯度（显示为红色），一直到网络的输入端。可以认为，梯度是从计算链路中回流。</p>
</blockquote>
<p>以上便是对反向传播最简单的一个解释，看完上述内容之后，应该就会有一个大概的印象了：反向传播是利用<strong>链式法则</strong>递归计算表达式的梯度的方法。</p>
<p><img src="https://ws1.sinaimg.cn/large/9db97af6gy1fkfhvs27azj20ob0dmacc.jpg" alt="image"></p>
<blockquote>
<p>链式法则指出，门单元应该将回传的梯度乘以它对其的输入的局部梯度，从而得到整个网络的输出对该门单元的每个输入值的梯度。</p>
</blockquote>
<h2 id="反向传播的直观理解"><a href="#反向传播的直观理解" class="headerlink" title="反向传播的直观理解"></a>反向传播的直观理解</h2><p><strong>节选一段斯坦福大学 CS231n 课程的笔记</strong></p>
<p>反向传播是一个优美的局部过程。在整个计算线路图中，每个门单元都会得到一些输入并立即计算两个东西：1. 这个门的输出值，和2.其输出值关于输入值的局部梯度。门单元完成这两件事是完全独立的，它不需要知道计算线路中的其他细节。然而，一旦前向传播完毕，在反向传播的过程中，门单元门将最终获得整个网络的最终输出值在自己的输出值上的梯度。链式法则指出，门单元应该将回传的梯度乘以它对其的输入的局部梯度，从而得到整个网络的输出对该门单元的每个输入值的梯度。</p>
<blockquote>
<p>这里对于每个输入的乘法操作是基于链式法则的。该操作让一个相对独立的门单元变成复杂计算线路中不可或缺的一部分，这个复杂计算线路可以是神经网络等。</p>
</blockquote>
<p>下面通过例子来对这一过程进行理解。加法门收到了输入[-2, 5]，计算输出是3。既然这个门是加法操作，那么对于两个输入的局部梯度都是+1。网络的其余部分计算出最终值为-12。在反向传播时将递归地使用链式法则，算到加法门（是乘法门的输入）的时候，知道加法门的输出的梯度是-4。如果网络如果想要输出值更高，那么可以认为它会想要加法门的输出更小一点（因为负号），而且还有一个4的倍数。继续递归并对梯度使用链式法则，加法门拿到梯度，然后把这个梯度分别乘到每个输入值的局部梯度（就是让-4乘以x和y的局部梯度，x和y的局部梯度都是1，所以最终都是-4）。可以看到得到了想要的效果：如果x，y减小（它们的梯度为负），那么加法门的输出值减小，这会让乘法门的输出值增大。</p>
<p>因此，反向传播可以看做是门单元之间在通过梯度信号相互通信，只要让它们的输入沿着梯度方向变化，无论它们自己的输出值在何种程度上升或降低，都是为了让整个网络的输出值更高。</p>
<h2 id="扩展"><a href="#扩展" class="headerlink" title="扩展"></a>扩展</h2><p>下面给一些稍微复杂的例子，有兴趣的话可以自己使用反向传播动手计算梯度，对加深理解非常有帮助。</p>
<ul>
<li>带 sigmoid 函数的例子</li>
</ul>
<p><img src="https://ws1.sinaimg.cn/large/9db97af6gy1fkfj8e61mrj20lx066mx7.jpg" alt="image"></p>
<p><img src="https://ws1.sinaimg.cn/large/9db97af6gy1fkfj52hqt9j20go06amxp.jpg" alt="image"></p>
<ul>
<li>吴恩达教授机器学习课程中神经网络的例子</li>
</ul>
<p><img src="https://ws1.sinaimg.cn/large/9db97af6gy1fkfj9b9yxej214v0mz797.jpg" alt="image"></p>
<p><strong>全文完</strong></p>
<p><strong>感谢阅读</strong></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://androidhot.github.io/2017/08/02/2017-08-02-Skills/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Zhiwei Li">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="https://avatars3.githubusercontent.com/u/17120655?v=4&u=d17931ce5e11210e09e2caf8140a7cba9fe60a71&s=400">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="假装在香港">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/08/02/2017-08-02-Skills/" itemprop="url">规划下技术方向</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-08-02T23:01:07+08:00">
                2017-08-02
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Talk/" itemprop="url" rel="index">
                    <span itemprop="name">Talk</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>写一篇博客规划一下自己的技术方向。</p>
<p>其实关于技术方向规划每次都有在手机上的备忘录或者 Google Keep 里面简单的写过，为什么突然会有写篇博客的想法呢，因为最近在试用 <a href="https://github.com/drakeet" target="_blank" rel="external">drakeet</a> 的新 App <a href="https://play.google.com/store/apps/details?id=com.drakeet.purewriter&amp;hl=zh" target="_blank" rel="external">纯纯写作</a>，下午在公司休息的时候一口气写了很长一大段，所以就决定晚上整理下放到博客上面。</p>
<h3 id="Android"><a href="#Android" class="headerlink" title="Android"></a>Android</h3><p>先说 Android 吧，毕竟算是我目前最主要的方向和吃饭的家伙。Android 方面的技术真的应该加把劲努力了，Android App 方向很久没有学习以及写过东西了，Android Framework 层也是很久没有开发过了，都忘的差不多了。借口在这：之前毕业休假用掉两个月时间，回公司之后新手机项目用的 Firefox OS，用到的都是前端的那些技术。所以久而久之，Android 的技术也就越来越生疏了。也不知道是不是 JavaScript 写多了，前两天写 Java 还有点懵逼的。🤣</p>
<h3 id="iOS"><a href="#iOS" class="headerlink" title="iOS"></a>iOS</h3><p>前段时间心血来潮想学习 iOS 开发，估计是因为果粉心理作祟，说干就干呗，撸起袖子翻开 Swift 官方文档就是干。不过这两天权衡了之后，iOS 开发这件事暂时放下了，Swift 官方文档学习了三分之一，因为同时在学其他的一些东西，加上 iOS 开发和 Android 开发一样，不是会了编程语言就 OK 了，得花大把的时间学习和 iOS 开发相关的一整套东西，时间不太充裕，所以就暂时放下了，等以后看看还有没有机会再继续开始。还是挺想当一个 iOS 开发者的。🙄</p>
<h3 id="Python"><a href="#Python" class="headerlink" title="Python"></a>Python</h3><p>廖雪峰的 Python 教程学完了之后，就很少接触 Python 了。前几天在少数派看文章跟着教程用 Python 写了个简单的 <a href="https://www.alfredapp.com/" target="_blank" rel="external">Alfred</a> 的 workflow，顿悟脚本语言真厉害，能很快的解决一件小事，不用大动干戈。加上最近接触机器学习，Python 又用了起来。这门脚本语言，会好好用起来的。</p>
<h3 id="Front-End"><a href="#Front-End" class="headerlink" title="Front-End"></a>Front-End</h3><p>去年暑假在学校考驾校的那段时间，学习过前端的一些基础：HTML、CSS、JavaScript。因为 React Native 等一些原因，那时候前端特别火。后来因为我比较怕写 UI 代码，主要是网页是个很大的东西，不像写 Android UI，就那么大个屏幕。就把前端给冷落了，直到现在，公司接了个 Firefox OS 的手机项目，就又把前端的技术捡了起来，这次和上次感觉很不一样，还是蛮有意思的，应该不会再把她打入冷宫了。毕竟学好了，后面还能用前端的技术写写 iOS 啥的，哈哈。</p>
<h3 id="Machine-Learning"><a href="#Machine-Learning" class="headerlink" title="Machine Learning"></a>Machine Learning</h3><p>机器学习时下是个很火的话题，当然跑不掉，目前在学吴教授的<a href="https://www.coursera.org/learn/machine-learning" target="_blank" rel="external">机器学习课程</a>，这套课程非常棒，吴教程讲的也非常好，力荐。过段时间应该就会开始并行学习 Tensorflow 的官方文档，实现一些小 demo，顺便把 Python 用起来。</p>
<p><strong>全文完</strong></p>
<p><strong>感谢阅读</strong></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://androidhot.github.io/2017/04/15/2017-04-15-HelloWorld/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Zhiwei Li">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="https://avatars3.githubusercontent.com/u/17120655?v=4&u=d17931ce5e11210e09e2caf8140a7cba9fe60a71&s=400">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="假装在香港">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/04/15/2017-04-15-HelloWorld/" itemprop="url">Hello World</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-04-15T14:44:35+08:00">
                2017-04-15
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Talk/" itemprop="url" rel="index">
                    <span itemprop="name">Talk</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p> 终于将博客搭起来了。第一篇，记录一下这几个月发生的大事情。</p>
<h2 id="工作"><a href="#工作" class="headerlink" title="工作"></a>工作</h2><p>去年11月份只身从自贡到成都找工作 ，在成都东客站附近租了房子：550一个月、套五、交三押一，在完全不知道能不能找到工作、以及找到工作公司离住的地方的远不远的情况下租房子，压力还是挺大的。这就是学校 ( 家 ) 没在成都的弊端。找工作也是一度对人生产生怀疑：</p>
<ol>
<li>已经尽力避免往培训公司投简历了，不过还是能够收到各种培训公司的面试邀请，并且面试官极其没有水平。</li>
<li>各种职位都投，Android 方面能投的职位都投了，音信全无。就只好投了些 Java 、前端，甚至还投过<strong>书籍信息录入员</strong>。唉，想想就心酸。</li>
</ol>
<p>所幸，结局是完美的，在面试了四个星期和十家公司( of course，有接近一半是骗子公司 )后，有两家公司同时给我发了 offer。分别是 Android App 开发和 Android Framework 开发，根据当时两家公司的地理位置和待遇，我选了后者，12月8号入职，到今天已经实习了四个多月了，在这里学到了很多东西，<strong>大四实习的这一年会比前三年在学校学到的东西还要多</strong>，这句话是非常正确的。在公司每天都过的很开心，没有遇到一件不爽的事，事实证明我的选择是对的。公司真的非常棒，至少对于实习生来说非常棒了( 这句话是我导师对我说过的话，他下周五要离职了，想必是找到了更好的去处，他教给了我很多东西，祝福他 )。提供免费住宿，空调热水器都有。公司氛围也是极好，颠覆了我曾经对公司的理解。</p>
<h2 id="爱情"><a href="#爱情" class="headerlink" title="爱情"></a>爱情</h2><p><code>Girlfriend sweetie = new Girlfriend();</code></p>
<p>我从程序员升级成有女朋友的程序员啦，她是我高中喜欢了三年的姑娘。</p>
<p>这是今年最开心的一件事，虽然今年才过去不到三分之一。</p>
<p>引用朋友的一句话：</p>
<blockquote>
<p>我觉得你现在状态很不错啊，有喜欢的工作，有喜欢的人，每天都很开心，这样就很好啊，真的。你看，你以前还跟我说担心未来会过的不好。</p>
</blockquote>
<p>短短的几个月，从当初的怀疑人生到现在的爱情事业双丰收，生活就像一盒巧克力，哈哈哈。</p>
<h2 id="Future"><a href="#Future" class="headerlink" title="Future"></a>Future</h2><p>这个月上完班，就请假开始毕业休假了。</p>
<p>和女朋友去我出生的地方<strong>三亚</strong>玩一个星期，因为从重庆飞，所以会先在重庆玩两天，可以欣赏一下传说中媲美香港的夜景哈哈哈。</p>
<p>然后回学校写论文和答辩，享受下最后的大学生活，以后就是上班族了。( 手动笑抽 )</p>
<p><strong>全文完</strong></p>
<p><strong>感谢阅读</strong></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
  </section>

  


          </div>
          


          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      

      <section class="site-overview sidebar-panel sidebar-panel-active">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <img class="site-author-image" itemprop="image"
               src="https://avatars3.githubusercontent.com/u/17120655?v=4&u=d17931ce5e11210e09e2caf8140a7cba9fe60a71&s=400"
               alt="Zhiwei Li" />
          <p class="site-author-name" itemprop="name">Zhiwei Li</p>
           
              <p class="site-description motion-element" itemprop="description">Stay hungry, Stay foolish.</p>
          
        </div>
        <nav class="site-state motion-element">

          
            <div class="site-state-item site-state-posts">
              <a href="/archives/">
                <span class="site-state-item-count">9</span>
                <span class="site-state-item-name">日志</span>
              </a>
            </div>
          

          
            
            
            <div class="site-state-item site-state-categories">
              <a href="/categories/index.html">
                <span class="site-state-item-count">4</span>
                <span class="site-state-item-name">分类</span>
              </a>
            </div>
          

          

        </nav>

        

        <div class="links-of-author motion-element">
          
            
              <span class="links-of-author-item">
                <a href="https://github.com/AndroidHot" target="_blank" title="GitHub">
                  
                    <i class="fa fa-fw fa-github"></i>
                  
                    
                      GitHub
                    
                </a>
              </span>
            
              <span class="links-of-author-item">
                <a href="http://weibo.com/506456423" target="_blank" title="Weibo">
                  
                    <i class="fa fa-fw fa-weibo"></i>
                  
                    
                      Weibo
                    
                </a>
              </span>
            
              <span class="links-of-author-item">
                <a href="mailto:zhiwei.dev@gmail.com" target="_blank" title="E-Mail">
                  
                    <i class="fa fa-fw fa-envelope"></i>
                  
                    
                      E-Mail
                    
                </a>
              </span>
            
          
        </div>

        
        

        
        

        


      </section>

      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright" >
  
  &copy; 
  <span itemprop="copyrightYear">2019</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Zhiwei Li</span>
</div>


<div class="powered-by">
  由 <a class="theme-link" href="https://hexo.io">Hexo</a> 强力驱动
</div>

<div class="theme-info">
  主题 -
  <a class="theme-link" href="https://github.com/iissnan/hexo-theme-next">
    NexT.Mist
  </a>
</div>


        

        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  












  
  <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>

  
  <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>

  
  <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.2"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.2"></script>



  
  

  
    <script type="text/javascript" src="/js/src/scrollspy.js?v=5.1.2"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=5.1.2"></script>

  

  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.2"></script>



  


  




	





  





  






  





  

  

  

  

  

  

</body>
</html>
